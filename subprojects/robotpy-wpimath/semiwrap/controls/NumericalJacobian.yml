defaults:
  subpackage: system

extra_includes:
- frc_eigen.h
- frc/EigenCore.h
- nanobind/stl/function.h
- nanobind/typing.h

functions:
  NumericalJacobian:
    overloads:
      F&&, const Vectord<Cols>&:
        ignore: true
      F&&, const Eigen::VectorXd&:
        no_release_gil: true
        cpp_code: |
          [](nb::typed<nb::callable, Eigen::VectorXd(Eigen::VectorXd)> fn,
             const Eigen::MatrixXd& x) {
            Eigen::VectorXd xv = x.col(0);
            return frc::NumericalJacobian([=](const Eigen::VectorXd& ix) {
              return nb::cast<Eigen::VectorXd>(fn(ix));
            }, xv);
          }
  NumericalJacobianX:
    overloads:
      F&&, const Vectord<States>&, const Vectord<Inputs>&, Args&&...:
        ignore: true
      F&&, const Eigen::VectorXd&, const Eigen::VectorXd&, Args&&...:
        no_release_gil: true
        cpp_code: |
          [](nb::typed<nb::callable, Eigen::VectorXd(Eigen::VectorXd, Eigen::VectorXd)> fn,
             const Eigen::MatrixXd& x, const Eigen::MatrixXd& u, nb::args args) {
             Eigen::VectorXd xv = x.col(0);
             Eigen::VectorXd uv = u.col(0);
             return frc::NumericalJacobianX([=](const Eigen::VectorXd &ix, const Eigen::VectorXd &iu) {
                nb::object r = fn(ix, iu, *args);
                return nb::cast<Eigen::VectorXd>(r);
             }, xv, uv);
          }
  NumericalJacobianU:
    overloads:
      F&&, const Vectord<States>&, const Vectord<Inputs>&, Args&&...:
        ignore: true
      F&&, const Eigen::VectorXd&, const Eigen::VectorXd&, Args&&...:
        no_release_gil: true
        cpp_code: |-
          [](nb::typed<nb::callable, Eigen::VectorXd(Eigen::VectorXd, Eigen::VectorXd)> fn,
             const Eigen::MatrixXd& x, const Eigen::MatrixXd& u, nb::args args) {
             Eigen::VectorXd xv = x.col(0);
             Eigen::VectorXd uv = u.col(0);
             return frc::NumericalJacobianU([=](const Eigen::VectorXd &ix, const Eigen::VectorXd &iu) {
                nb::object r = fn(ix, iu, *args);
                return nb::cast<Eigen::VectorXd>(r);
             }, xv, uv);
          }
